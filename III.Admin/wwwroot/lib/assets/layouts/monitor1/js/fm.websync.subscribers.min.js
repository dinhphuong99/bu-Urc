
/*
 * Title: WebSync Client Subscribers Extension for JavaScript
 * Version: 4.8.6
 * Copyright Frozen Mountain Software 2011+
 */

!function(e,t,n){if("function"==typeof define&&define.amd)define(e,t,n);else if("object"==typeof exports){for(var s=0;s<t.length;s++)require("./"+t[s]);module.exports=n()}else this[e]=n()}("fm.websync.subscribers",["fm.websync","fm"],function(){if("undefined"==typeof global||global.window||(global.window=global,global.document={cookie:""}),!window.fm)throw new Error("fm must be loaded before fm.websync.subscribers.");if(!window.fm.websync)throw new Error("fm.websync must be loaded before fm.websync.subscribers.");window.fm.websync.subscribers||(window.fm.websync.subscribers={}),fm.websync.subscribers.getVersion=function(){return"4.8.6"},fm.websync.subscribers.subscriberChangeType={Subscribe:1,Unsubscribe:2};var e=function(e,n){function s(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return s.prototype=n.prototype,e.prototype=new s,e.__super__=n.prototype,e},t={}.hasOwnProperty;fm.websync.subscribers.base=function(t){function n(){return 1===arguments.length&&fm.util.isPlainObject(arguments[0])?(n.__super__.constructor.call(this),void fm.util.attachProperties(this,arguments[0])):void 0}return e(n,t),n._subscribersChannelPrefix="/fm/subscribers",n._subscribersExtensionName="fm.subscribers",n.getSubscribedClients=function(){var e,t,n;if(n=arguments[0],t=fm.websync.subscribers.serializer.deserializeSubscribedClients(n.getExtensionValueJson("fm.subscribers")),e=t,null===e||"undefined"==typeof e)throw new Error("Subscribed clients could not be parsed.");return t},n.setSubscribedClients=function(){var e,t;return e=arguments[0],t=arguments[1],e.setExtensionValueJson("fm.subscribers",fm.websync.subscribers.serializer.serializeSubscribedClients(t))},n}(fm.object);var n=function(e,t){return function(){return e.apply(t,arguments)}},e=function(e,n){function s(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return s.prototype=n.prototype,e.prototype=new s,e.__super__=n.prototype,e},t={}.hasOwnProperty;fm.websync.subscribers.clientUnsubscribeArgs=function(t){function s(){this.getUnsubscribedClient=n(this.getUnsubscribedClient,this),this.getChannel=n(this.getChannel,this);var e,t;return 1===arguments.length&&fm.util.isPlainObject(arguments[0])?(s.__super__.constructor.call(this),void fm.util.attachProperties(this,arguments[0])):(e=arguments[0],t=arguments[1],s.__super__.constructor.call(this),this.__channel=e,void(this.__unsubscribedClient=t))}return e(s,t),s.prototype.__channel=null,s.prototype.__unsubscribedClient=null,s.prototype.getChannel=function(){return this.__channel},s.prototype.getUnsubscribedClient=function(){return this.__unsubscribedClient},s}(fm.websync.baseSuccessArgs);var e=function(e,n){function s(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return s.prototype=n.prototype,e.prototype=new s,e.__super__=n.prototype,e},t={}.hasOwnProperty;fm.websync.subscribers.serializer=function(t){function n(){return 1===arguments.length&&fm.util.isPlainObject(arguments[0])?(n.__super__.constructor.call(this),void fm.util.attachProperties(this,arguments[0])):void n.__super__.constructor.call(this)}return e(n,t),n.createSubscribedClients=function(){return{}},n.createSubscriberChange=function(){return new fm.websync.subscribers.subscriberChange},n.deserializeSubscribedClients=function(){var e;return e=arguments[0],fm.serializer.deserializeObject(e,n.createSubscribedClients,n.deserializeSubscribedClientsCallback)},n.deserializeSubscribedClientsCallback=function(){var e,t,n;return t=arguments[0],e=arguments[1],n=arguments[2],t[e]=fm.websync.subscribedClient.fromJsonMultiple(n)},n.deserializeSubscriberChange=function(){var e;return e=arguments[0],fm.serializer.deserializeObjectFast(e,n.createSubscriberChange,n.deserializeSubscriberChangeCallback)},n.deserializeSubscriberChangeCallback=function(){var e,t,n,s,r;if(s=arguments[0],t=arguments[1],r=arguments[2],n=t,e=n,null!==e&&"undefined"!=typeof e){if("client"===n)return s.setClient(fm.websync.subscribedClient.fromJson(r));if("type"===n)return s.setType(fm.websync.subscribers.serializer.deserializeSubscriberChangeType(r))}},n.deserializeSubscriberChangeType=function(){var e;switch(e=arguments[0],fm.serializer.deserializeString(e)){case"subscribe":return fm.websync.subscribers.subscriberChangeType.Subscribe;case"unsubscribe":return fm.websync.subscribers.subscriberChangeType.Unsubscribe}throw new Error("Unknown subscriber change type.")},n.serializeSubscribedClients=function(){var e;return e=arguments[0],fm.serializer.serializeObject(e,n.serializeSubscribedClientsCallback)},n.serializeSubscribedClientsCallback=function(){var e,t,n,s,r,i,o;for(o=arguments[0],n=arguments[1],e=fm.hashExtensions.getKeys(o),r=[],t=0,s=e.length;s>t;t++)i=e[t],r.push(n[i]=fm.websync.subscribedClient.toJsonMultiple(o[i]));return r},n.serializeSubscriberChange=function(){var e;return e=arguments[0],fm.serializer.serializeObjectFast(e,n.serializeSubscriberChangeCallback)},n.serializeSubscriberChangeCallback=function(){var e,t,n;return n=arguments[0],t=arguments[1],e=n.getClient(),null!==e&&"undefined"!=typeof e&&(t.client=fm.websync.subscribedClient.toJson(n.getClient())),t.type=fm.websync.subscribers.serializer.serializeSubscriberChangeType(n.getType())},n.serializeSubscriberChangeType=function(){var e,t;switch(t=arguments[0]){case fm.websync.subscribers.subscriberChangeType.Subscribe:e="subscribe";break;case fm.websync.subscribers.subscriberChangeType.Unsubscribe:e="unsubscribe";break;default:throw new Error("Unknown subscriber change type.")}return fm.serializer.serializeString(e)},n}(fm.object),fm.websync.subscribers.subscribeArgsExtensions=function(){function e(){return 1===arguments.length&&fm.util.isPlainObject(arguments[0])?(e.__super__.constructor.call(this),void fm.util.attachProperties(this,arguments[0])):void 0}return e._onClientSubscribePropertyName=null,e._onClientUnsubscribePropertyName=null,e.client_OnReceive=function(){var e,t,n,s,r,i,o,a,u,c,l,h,p,g,f,m,d;if(l=arguments[0],u=fm.websync.subscribers.serializer.deserializeSubscriberChange(l.getDataJson()),e=u.getClient().getClientId(),null===e?e!==l.getClient().getClientId():!e.equals(l.getClient().getClientId()))if(c=fm.global.tryCastObject(l.getClient().getDynamicValue(fm.websync.subscribers.subscribeArgsExtensions.getDynamicPropertiesKey(l.getChannel()))),u.getType()===fm.websync.subscribers.subscriberChangeType.Subscribe){if(s=fm.global.tryCast(l.getClient().getDynamicValue(fm.websync.subscribers.subscribeArgsExtensions.getOnClientSubscribeKey(l.getChannel())),Function),t=s,null!==t&&"undefined"!=typeof t){i=new fm.websync.subscribers.clientSubscribeArgs(l.getChannel().substring("/fm/subscribers".length),u.getClient()),i.setTimestamp(l.getTimestamp()),i.setClient(l.getClient()),i.setDynamicProperties(c),d=i,d.copyExtensions(l);try{return s(d)}catch(h){if(f=h,g=f,!l.getClient().raiseUnhandledException(g))return fm.asyncException.asyncThrow(g,"Client -> Subscribe -> OnClientSubscribe")}finally{}}}else if(r=fm.global.tryCast(l.getClient().getDynamicValue(fm.websync.subscribers.subscribeArgsExtensions.getOnClientUnsubscribeKey(l.getChannel())),Function),n=r,null!==n&&"undefined"!=typeof n){a=new fm.websync.subscribers.clientUnsubscribeArgs(l.getChannel().substring("/fm/subscribers".length),u.getClient()),a.setTimestamp(l.getTimestamp()),a.setClient(l.getClient()),a.setDynamicProperties(c),o=a,o.copyExtensions(l);try{return r(o)}catch(p){if(m=p,g=m,!l.getClient().raiseUnhandledException(g))return fm.asyncException.asyncThrow(g,"Client -> Subscribe -> OnClientUnsubscribe")}finally{}}},e.client_OnSubscribeEnd=function(){var t,n,s,r,i,o,a,u,c,l,h,p,g;if(o=arguments[0],i=arguments[1],t=i.getException(),(null===t||"undefined"==typeof t)&&(c=fm.websync.subscribers.subscribeArgsExtensions.getOnClientSubscribe(i.getMethodArgs()),l=fm.websync.subscribers.subscribeArgsExtensions.getOnClientUnsubscribe(i.getMethodArgs()),n=c,s=l,null!==n&&"undefined"!=typeof n||null!==s&&"undefined"!=typeof s)){for(r=i.getResponse().getChannels(),h=[],a=0,u=r.length;u>a;a++)p=r[a],g=fm.stringExtensions.concat("/fm/subscribers",p),o.setDynamicValue(fm.websync.subscribers.subscribeArgsExtensions.getOnClientSubscribeKey(g),c),o.setDynamicValue(fm.websync.subscribers.subscribeArgsExtensions.getOnClientUnsubscribeKey(g),l),o.setDynamicValue(fm.websync.subscribers.subscribeArgsExtensions.getDynamicPropertiesKey(g),i.getMethodArgs().getDynamicProperties()),h.push(i.getClient().setCustomOnReceive(g,e.client_OnReceive));return h}},e.client_OnSubscribeRequest=function(){var e,t,n,s,r,i,o,a,u,c,l;if(r=arguments[0],s=arguments[1],u=fm.websync.subscribers.subscribeArgsExtensions.getOnClientSubscribe(s.getMethodArgs()),c=fm.websync.subscribers.subscribeArgsExtensions.getOnClientUnsubscribe(s.getMethodArgs()),e=u,t=c,null!==e&&"undefined"!=typeof e||null!==t&&"undefined"!=typeof t){for(a=[],n=s.getMethodArgs().getChannels(),i=0,o=n.length;o>i;i++)l=n[i],fm.arrayExtensions.add(a,l),fm.arrayExtensions.add(a,fm.stringExtensions.concat("/fm/subscribers",l));return s.getMethodArgs().setChannels(fm.arrayExtensions.toArray(a))}},e.client_OnSubscribeResponse=function(){var e,t,n,s,r,i,o,a;if(s=arguments[0],n=arguments[1],e=n.getException(),null===e||"undefined"==typeof e){for(o=[],t=n.getResponse().getChannels(),r=0,i=t.length;i>r;r++)a=t[r],fm.stringExtensions.startsWith(a,"/fm/subscribers/")||fm.arrayExtensions.add(o,a);return n.getMethodArgs().setChannels(fm.arrayExtensions.toArray(o)),n.getResponse().setChannels(fm.arrayExtensions.toArray(o))}},e.client_OnUnsubscribeRequest=function(){var e,t,n,s,r,i,o;for(t=arguments[0],n=arguments[1],i=[],e=n.getMethodArgs().getChannels(),s=0,r=e.length;r>s;s++)o=e[s],fm.arrayExtensions.add(i,o),fm.arrayExtensions.add(i,fm.stringExtensions.concat("/fm/subscribers",o));return n.getMethodArgs().setChannels(fm.arrayExtensions.toArray(i))},e.client_OnUnsubscribeResponse=function(){var e,t,n,s,r,i,o,a,u,c,l;if(s=arguments[0],r=arguments[1],e=r.getException(),null===e||"undefined"==typeof e){for(t=r.getResponse().getChannels(),i=0,a=t.length;a>i;i++)l=t[i],fm.stringExtensions.startsWith(l,"/fm/subscribers")&&(r.getClient().unsetCustomOnReceive(l),r.getClient().unsetDynamicValue(fm.websync.subscribers.subscribeArgsExtensions.getOnClientSubscribeKey(l)),r.getClient().unsetDynamicValue(fm.websync.subscribers.subscribeArgsExtensions.getOnClientUnsubscribeKey(l)),r.getClient().unsetDynamicValue(fm.websync.subscribers.subscribeArgsExtensions.getDynamicPropertiesKey(l)));for(c=[],n=r.getResponse().getChannels(),o=0,u=n.length;u>o;o++)l=n[o],fm.stringExtensions.startsWith(l,"/fm/subscribers/")||fm.arrayExtensions.add(c,l);return r.getMethodArgs().setChannels(fm.arrayExtensions.toArray(c)),r.getResponse().setChannels(fm.arrayExtensions.toArray(c))}},e.getDynamicPropertiesKey=function(){var e;return e=arguments[0],fm.stringExtensions.concat("fm.subscribers.dynamicProperties",e)},e.getOnClientSubscribe=function(){var e;return e=arguments[0],e.getDynamicValue(fm.websync.subscribers.subscribeArgsExtensions._onClientSubscribePropertyName)},e.getOnClientSubscribeKey=function(){var e;return e=arguments[0],fm.stringExtensions.concat("fm.subscribers.onClientSubscribe",e)},e.getOnClientUnsubscribe=function(){var e;return e=arguments[0],e.getDynamicValue(fm.websync.subscribers.subscribeArgsExtensions._onClientUnsubscribePropertyName)},e.getOnClientUnsubscribeKey=function(){var e;return e=arguments[0],fm.stringExtensions.concat("fm.subscribers.onClientUnsubscribe",e)},e.setOnClientSubscribe=function(){var e,t;return e=arguments[0],t=arguments[1],e.setDynamicValue(fm.websync.subscribers.subscribeArgsExtensions._onClientSubscribePropertyName,t),e},e.setOnClientUnsubscribe=function(){var e,t;return e=arguments[0],t=arguments[1],e.setDynamicValue(fm.websync.subscribers.subscribeArgsExtensions._onClientUnsubscribePropertyName,t),e},fm.websync.subscribeArgs.prototype.getOnClientSubscribe=function(){return Array.prototype.splice.call(arguments,0,0,this),fm.websync.subscribers.subscribeArgsExtensions.getOnClientSubscribe.apply(this,arguments)},fm.websync.subscribeArgs.prototype.getOnClientUnsubscribe=function(){return Array.prototype.splice.call(arguments,0,0,this),fm.websync.subscribers.subscribeArgsExtensions.getOnClientUnsubscribe.apply(this,arguments)},fm.websync.subscribeArgs.prototype.setOnClientSubscribe=function(){var e;return e=arguments[0],Array.prototype.splice.call(arguments,0,0,this),fm.websync.subscribers.subscribeArgsExtensions.setOnClientSubscribe.apply(this,arguments)},fm.websync.subscribeArgs.prototype.setOnClientUnsubscribe=function(){var e;return e=arguments[0],Array.prototype.splice.call(arguments,0,0,this),fm.websync.subscribers.subscribeArgsExtensions.setOnClientUnsubscribe.apply(this,arguments)},e._onClientSubscribePropertyName="fm.subscribers.onClientSubscribe",e._onClientUnsubscribePropertyName="fm.subscribers.onClientUnsubscribe",fm.websync.client.addOnSubscribeRequest(e.client_OnSubscribeRequest),fm.websync.client.addOnSubscribeResponse(e.client_OnSubscribeResponse),fm.websync.client.addOnSubscribeEnd(e.client_OnSubscribeEnd),fm.websync.client.addOnUnsubscribeRequest(e.client_OnUnsubscribeRequest),fm.websync.client.addOnUnsubscribeResponse(e.client_OnUnsubscribeResponse),e}();var n=function(e,t){return function(){return e.apply(t,arguments)}},e=function(e,n){function s(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return s.prototype=n.prototype,e.prototype=new s,e.__super__=n.prototype,e},t={}.hasOwnProperty;fm.websync.subscribers.subscriberChange=function(t){function s(){return this.toJson=n(this.toJson,this),this.setType=n(this.setType,this),this.setClient=n(this.setClient,this),this.getType=n(this.getType,this),this.getClient=n(this.getClient,this),1===arguments.length&&fm.util.isPlainObject(arguments[0])?(s.__super__.constructor.call(this),void fm.util.attachProperties(this,arguments[0])):void s.__super__.constructor.call(this)}return e(s,t),s.prototype.__client=null,s.prototype.__type=null,s.fromJson=function(){var e;return e=arguments[0],fm.websync.subscribers.serializer.deserializeSubscriberChange(e)},s.toJson=function(){var e;return e=arguments[0],fm.websync.subscribers.serializer.serializeSubscriberChange(e)},s.prototype.getClient=function(){return this.__client},s.prototype.getType=function(){return this.__type},s.prototype.setClient=function(){var e;return e=arguments[0],this.setIsDirty(!0),this.__client=e},s.prototype.setType=function(){var e;return e=arguments[0],this.setIsDirty(!0),this.__type=e},s.prototype.toJson=function(){return fm.websync.subscribers.subscriberChange.toJson(this)},s}(fm.serializable);var n=function(e,t){return function(){return e.apply(t,arguments)}},e=function(e,n){function s(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return s.prototype=n.prototype,e.prototype=new s,e.__super__=n.prototype,e},t={}.hasOwnProperty;return fm.websync.subscribers.clientSubscribeArgs=function(t){function s(){this.getSubscribedClient=n(this.getSubscribedClient,this),this.getChannel=n(this.getChannel,this);var e,t;return 1===arguments.length&&fm.util.isPlainObject(arguments[0])?(s.__super__.constructor.call(this),void fm.util.attachProperties(this,arguments[0])):(e=arguments[0],t=arguments[1],s.__super__.constructor.call(this),this.__channel=e,void(this.__subscribedClient=t))}return e(s,t),s.prototype.__channel=null,s.prototype.__subscribedClient=null,s.prototype.getChannel=function(){return this.__channel},s.prototype.getSubscribedClient=function(){return this.__subscribedClient},s}(fm.websync.baseSuccessArgs),fm.websync.subscribers.subscribeSuccessArgsExtensions=function(){function e(){return 1===arguments.length&&fm.util.isPlainObject(arguments[0])?(e.__super__.constructor.call(this),void fm.util.attachProperties(this,arguments[0])):void 0}return e.getSubscribedClients=function(){var e;return e=arguments[0],fm.websync.subscribers.base.getSubscribedClients(e)},fm.websync.subscribeSuccessArgs.prototype.getSubscribedClients=function(){return Array.prototype.splice.call(arguments,0,0,this),fm.websync.subscribers.subscribeSuccessArgsExtensions.getSubscribedClients.apply(this,arguments)},e}(),fm.websync.subscribers});